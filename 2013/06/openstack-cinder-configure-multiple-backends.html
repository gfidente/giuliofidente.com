<!DOCTYPE html>
<html lang="en">

<head>
  <link rel="stylesheet/less" type="text/css" href="http://giuliofidente.com/theme/css/style.less">
  <script src="http://giuliofidente.com/theme/js/less-1.3.3.min.js" type="text/javascript"></script>
  <!-- <link rel="stylesheet" type="text/css" href="http://giuliofidente.com/theme/css/style.css"> -->

  <link rel="stylesheet" type="text/css" href="http://giuliofidente.com/theme/css/pygments.css">
  <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=PT+Sans|PT+Serif|PT+Mono">

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width; initial-scale=1.0">
  <meta name="author" content="Giulio Fidente">
  <meta name="description" content="Posts and writings by Giulio Fidente">

    <link href="http://giuliofidente.com/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Giulio Fidente (aka Giulivo Navigante) Full Atom Feed" />
    
  <meta name="keywords" content="openstack, cinder, fedoraplanet">

  <title>
    OpenStack Cinder - Configure multiple backends  </title>

  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-39216528-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>
</head>

<body>
  <aside>
    <div id="user_meta">
      <a href="http://giuliofidente.com">
                <img src="http://giuliofidente.com/static/images/gravatar_to140.png" alt="logo">
              </a>
      <h2><a href="http://giuliofidente.com">Giulio Fidente</a></h2>
      <p>Systems engineer devoted to automation. Enjoy web programming. Work @Red Hat.</p>
      <ul>
                        <li><a href="http://giuliofidente.com/pages/about.html">About</a></li>
                <li><a href="http://giuliofidente.com/pages/projects.html">Projects</a></li>
                                <li><a href="mailto:giulioATgiuliofidenteDOTcom" target="_blank">Email</a></li>
              </ul>
    </div>
  </aside>

  <main>
    <header>
      <p>Posted on Sun 16 June 2013</p>
    </header>

    <article>
  <div id="article_title">
    <h3><a href="http://giuliofidente.com/2013/06/openstack-cinder-configure-multiple-backends.html">OpenStack Cinder - Configure multiple backends</a></h3>
  </div>
  <div id="article_text">
    <p>Following <a class="reference external" href="http://giuliofidente.com/2013/04/openstack-cinder-add-more-volume-nodes.html">my first post of the series</a> discussing how to scale <a class="reference external" href="http://www.openstack.org">OpenStack</a> <a class="reference external" href="https://wiki.openstack.org/wiki/Cinder">Cinder</a> to multiple nodes, with this I want to approach the configuration and usage of the multibackend feature landed in Cinder with the Grizzly release.</p>
<p>This feature allows you to configure a single volume node for use with more than a single backend driver. You can find all about the few configuration bits neede also in the <a class="reference external" href="http://docs.openstack.org/trunk/openstack-block-storage/admin/content/multi_backend.html">OpenStack block storage documentation</a>, that makes this post redundant for the most part.</p>
<p>Some assumptions before we start though:</p>
<ul class="simple">
<li>you're familiar with the general OpenStack architecture</li>
<li>you have already some Cinder volume node configured and working as expected</li>
</ul>
<p>Assuming we want our node, currently using LVM, configured with an additional NFS backend, this is what we would need:</p>
<pre class="literal-block">
enabled_backends=lvm1,nfs1
[lvm1]
volume_driver=cinder.volume.drivers.lvm.LVMISCSIDriver
volume_backend_name=LVM_iSCSI
[nfs1]
nfs_shares_config=${PATH_TO_YOUR_SHARES_FILE}
volume_driver=cinder.volume.drivers.nfs.NfsDriver
volume_backend_name=NFS
</pre>
<p>The enabled_backends value defines the names (separated by a comma) of the config groups and those do not have to match the driver name nor the backend name. You'll have to restart the volume service.</p>
<p>When that is done, to use a particular backend when allocating new volumes you'll have to pass a <code>volume_type</code> parameter to the creation command. Such a type has to be created beforehand and the backends assigned to it:</p>
<pre class="literal-block">
# cinder type-create lvm
# cinder type-create nfs
# cinder type-key lvm1 set volume_backend_name=LVM_iSCSI
# cinder type-key nfs1 set volume_backend_name=NFS
</pre>
<p>Finally, to create your volumes:</p>
<pre class="literal-block">
# cinder create --volume_type lvm --display_name inlvm 1
</pre>
<p>An addition for people using the REST interface, to set any <code>type-key</code> property, including <code>volume_backend_name</code> you pass that in the request as some <a class="reference external" href="https://github.com/openstack/cinder/blob/master/cinder/api/contrib/types_extra_specs.py">extra specs</a> and you can list those indeed to make sure the configuration is successful:</p>
<pre class="literal-block">
#  cinder extra-specs-list
</pre>
<p>You can have backends of the same type (driver) using different names (say two LVM based backends allocating volumes in different volume groups) or you can also have backends of the same type using the same name! The scheduler will make a decision on how to pickup the correct backend at creation time. Here are a few notes borrowed from the documentation  regarding the filter scheduler (enabled by default in Grizzly):</p>
<ul class="simple">
<li>filters the available backends (by default, AvailabilityZoneFilter, CapacityFilter and CapabilitiesFilter are enabled)</li>
<li>weights the previously filtered backends (by default, CapacityWeigher is enabled).</li>
</ul>
<p>The CapacityWeigher attributes high score to backends with the most available space.</p>

  </div>
  <div id="article_meta">
    <p>Category: <a href="http://giuliofidente.com/category/techie.html">techie</a></p>
        <p>Tags:
            <a href="http://giuliofidente.com/tag/openstack.html">openstack</a>,            <a href="http://giuliofidente.com/tag/cinder.html">cinder</a>,            <a href="http://giuliofidente.com/tag/fedoraplanet.html">fedoraplanet</a>          </p>
      </div>
</article>

    <footer>
      <p><a href="http://giuliofidente.com/" class="button_accent">&larr; Back to Index</a></p>
    </footer>

    <div id="ending_message">
      <p>&copy Giulio Fidente. Built using <a href="http://getpelican.com" target="_blank">Pelican</a>. You can fork the theme on <a href="https://github.com/giulivo/pelican-svbhack" target="_blank">github</a>. Member of the <a href="http://internetdefenseleague.org">Internet Defense League</a>.</p>
    </div>
  </main>
  <script type="text/javascript">
  window._idl = {};
  _idl.variant = "banner";
  (function() {
    var idl = document.createElement('script');
    idl.type = 'text/javascript';
    idl.async = true;
    idl.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'members.internetdefenseleague.org/include/?url=' + (_idl.url || '') + '&campaign=' + (_idl.campaign || '') + '&variant=' + (_idl.variant || 'banner');
    document.getElementsByTagName('body')[0].appendChild(idl);
  })();
</script>
</body>
</html>